/*! Socialight 1.2.0 | (c) 2015 Pedro RogÃ©rio | MIT License */
!function(a,b){"use strict";"function"==typeof define&&define.amd?define([],b):"object"==typeof exports?module.exports=b():a.Socialight=b()}(this,function(){"use strict";Array.prototype.indexOf||(Array.prototype.indexOf=function(a,b){var c;if(b=b||0,b>this.length)return-1;for(c=0;c<this.length;c+=1){if(this[c]===a&&c>=b)return c;if(this[c]===a&&b>c)return-1}return-1}),Function.prototype.hasOwnProperty("bind")||(Function.prototype.bind=function(){var a=this,b=arguments[0],c=Array.prototype.slice.call(arguments,1);return function(){return a.apply(b,c.concat(Array.prototype.slice.call(arguments)))}});var a=function(){return this&&this instanceof a?(this.container=document.querySelectorAll("[data-socialight-url]"),this.channels=["facebook","linkedin","googleplus","pinterest","buffer"],void this.ready()):new a};return a.prototype={post:function(a,b,c,d){var e=new XMLHttpRequest;e.open("POST",a,!0),e.setRequestHeader("X-Requested-With","XMLHttpRequest"),e.setRequestHeader("Content-Type","application/json"),e.setRequestHeader("Content-length",b.length),e.setRequestHeader("Connection","close"),e.onreadystatechange=function(){if(4===this.readyState)if(this.status>=200&&this.status<300||304===this.status){var a=JSON.parse(this.responseText);c.call(this,a)}else d.call(this,this.responseText)},e.send(b),e=null},jsonp:function(a,b,c){var d,e,f,g="jsonp_"+Math.round(1e5*Math.random());d=document.head||document.getElementsByTagName("head")[0],f=document.createElement("script"),f.type="text/javascript",e=f.cloneNode(),e.src=a+(a.indexOf("?")>=0?"&":"?")+"callback="+g,e.async=!0,d.appendChild(e),window[g]=function(a){b.call(c||window,a),d.removeChild(e),e=null,delete this.name}.bind(this)},abbrNum:function(a,b){b=Math.pow(10,b);var c,d,e=["k","m","b","t"];for(d=e.length-1;d>=0;d-=1)if(c=Math.pow(10,3*(d+1)),a>=c){a=Math.round(a*b/c)/b,1e3===a&&d<e.length-1&&(a=1,d+=1),a+=e[d];break}return a},each:function(a,b){for(var c=0,d=a.length;d>c;)b(a[c],c),c+=1},isInArray:function(a,b){return a.indexOf(b)>=0},isJson:function(a){try{var b=JSON.parse(a);if(b&&"object"==typeof b&&null!==b)return b}catch(c){console.log('%c You must pass a valid JSON in attribute "data-socialight-url". View a example here: https://github.com/pinceladasdaweb/Socialight/blob/master/example/index.html#L27',"background: red; color: white")}return!1},createChannels:function(){var a,b,c,d,e,f;for(c=0,f=this.container.length;f>c;c+=1)for(a=this.isJson(this.container[c].getAttribute("data-socialight-channels")),d=0,e=a.length;e>d;d+=1)this.isInArray(this.channels,a[d])&&(b=document.createElement("span"),b.setAttribute("data-socialight-channel",a[d]),this.container[c].appendChild(b).cloneNode(!0))},getUrl:function(a){return a.parentNode.getAttribute("data-socialight-url")},getCounterFb:function(){var a,b=document.querySelectorAll('[data-socialight-channel="facebook"]');this.each(b,function(b){a=this.getUrl(b),this.jsonp("https://graph.facebook.com/?id="+a,function(a){b.innerHTML=this.abbrNum(a.shares,1)}.bind(this))}.bind(this))},getCounterGooglePlus:function(){var a,b,c=document.querySelectorAll('[data-socialight-channel="googleplus"]');this.each(c,function(c){a=this.getUrl(c),b=JSON.stringify({method:"pos.plusones.get",id:a,params:{nolog:!0,id:a,source:"widget",userId:"@viewer",groupId:"@self"},jsonrpc:"2.0",key:"p",apiVersion:"v1"}),this.post("https://clients6.google.com/rpc",b,function(a){c.innerHTML=this.abbrNum(a.result.metadata.globalCounts.count,1)}.bind(this),function(a){console.log(a)})}.bind(this))},getCounterLinkedin:function(){var a,b=document.querySelectorAll('[data-socialight-channel="linkedin"]');this.each(b,function(b){a=this.getUrl(b),this.jsonp("https://www.linkedin.com/countserv/count/share?url="+a,function(a){b.innerHTML=this.abbrNum(a.count,1)}.bind(this))}.bind(this))},getCounterBuffer:function(){var a,b=document.querySelectorAll('[data-socialight-channel="buffer"]');this.each(b,function(b){a=this.getUrl(b),this.jsonp("https://api.bufferapp.com/1/links/shares.json?url="+a,function(a){b.innerHTML=this.abbrNum(a.shares,1)}.bind(this))}.bind(this))},getCounterPinterest:function(){var a,b=document.querySelectorAll('[data-socialight-channel="pinterest"]');this.each(b,function(b){a=this.getUrl(b),this.jsonp("https://api.pinterest.com/v1/urls/count.json?&url="+a,function(a){b.innerHTML=this.abbrNum(a.count,1)}.bind(this))}.bind(this))},getCounters:function(){this.getCounterFb(),this.getCounterGooglePlus(),this.getCounterLinkedin(),this.getCounterBuffer(),this.getCounterPinterest()},ready:function(){this.createChannels(),this.getCounters()}},a});